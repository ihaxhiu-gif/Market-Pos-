<!DOCTYPE html>
<html lang="sq">
<head>
<meta charset="UTF-8">
<title>POS Market ‚Äì LOCAL PRO</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">

<script src="https://unpkg.com/@ericblade/quagga2/dist/quagga.js"></script>

<style>
body{margin:0;font-family:Segoe UI;background:#eef2f7}
header{background:#1e293b;color:#fff;padding:15px}
nav button{margin:4px;padding:10px;border:none;border-radius:10px;background:#334155;color:#fff}
section{display:none;padding:15px}
section.active{display:block}
.card{background:#fff;padding:15px;border-radius:14px;margin-bottom:12px;box-shadow:0 8px 18px rgba(0,0,0,.1)}
input,button{padding:8px;border-radius:8px;border:1px solid #cbd5f5}
button{background:#2563eb;color:#fff;font-weight:600;margin:3px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:6px;border-bottom:1px solid #e5e7eb;text-align:center}
th{background:#f1f5f9}
.admin{display:none}
.qtyBtn{padding:4px 8px}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:999}
.modal-content{background:#fff;margin:80px auto;padding:15px;width:95%;max-width:420px;border-radius:14px}
</style>
</head>

<body>

<header>
<h2>üõí POS Market (LOCAL)</h2>
<nav id="menu" style="display:none">
<button onclick="openSec('prod')" class="admin">Stok</button>
<button onclick="openSec('sale')">Shitje</button>
<button onclick="openSec('bil')" class="admin">Bilanc</button>
<button onclick="logout()">Dil</button>
</nav>
</header>

<!-- LOGIN -->
<section id="loginSec" class="active">
<div class="card">
<h3>Login</h3>
<input id="u" placeholder="User">
<input id="p" type="password" placeholder="Password">
<button onclick="doLogin()">Hyr</button>
<p id="msg" style="color:red"></p>
</div>
</section>

<!-- STOK -->
<section id="prod">
<div class="card admin">
<h3>Shto / Edito Produkt</h3>
<input id="pn" placeholder="Emri">
<input id="pb" placeholder="Barkodi">
<input id="pp" type="number" placeholder="√ámimi">
<input id="ps" type="number" placeholder="Sasia">
<div>
<button onclick="openCam('stock','environment')">üì∑ Mbrapa</button>
<button onclick="openCam('stock','user')">ü§≥ Para</button>
<button onclick="addProduct()">üíæ Ruaj</button>
</div>
</div>
<table id="prodTable"></table>
</section>

<!-- SHITJE -->
<section id="sale">
<div class="card">
<input id="saleScan" placeholder="Em√´r / Barkod / USB Scanner">
<button onclick="manualAdd()">‚ûï Shto</button>
<button onclick="openCam('sale','environment')">üì∑ Mbrapa</button>
<button onclick="openCam('sale','user')">ü§≥ Para</button>
</div>

<div class="card">
<table id="saleTable"></table>
<h3>Total: <span id="tot">0</span> ALL</h3>
<input id="paid" type="number" placeholder="Lek√´ nga klienti">
<h3><span id="change">0</span></h3>
<button onclick="pay()">Paguaj</button>
<button onclick="cancel()">Anulo</button>
</div>
</section>

<!-- BILANC -->
<section id="bil" class="admin">
<div class="card">
<h3>Bilanci Ditor</h3>
<p>Sistemi: <b><span id="daily">0</span> ALL</b></p>
<input id="cashReal" type="number" placeholder="Para reale n√´ ark√´">
<p>Diferenca: <b><span id="diff">0</span></b></p>
<button onclick="closeDay()">Mbyll Dit√´n</button>
</div>
</section>

<!-- CAMERA -->
<div class="modal" id="cam">
<div class="modal-content">
<h3>Scan Barcode</h3>
<div id="scanner" style="height:260px"></div>
<button onclick="stopCam()">Mbyll</button>
</div>
</div>

<script>
/* USERS */
const users=[
 {u:'admin',p:'admin',r:'admin'},
 {u:'kasier',p:'kasier',r:'kasier'}
];
let role=null;

/* DATA (RUHEN) */
let products=JSON.parse(localStorage.getItem('products')||'[]');
let sales=[];
let daily=+localStorage.getItem('daily')||0;

/* CAMERA */
let scanTarget=null, scanLock=false;

/* LOGIN */
function doLogin(){
 let f=users.find(x=>x.u===u.value&&x.p===p.value);
 if(!f){msg.textContent='Gabim login';return;}
 role=f.r;
 loginSec.style.display='none';
 menu.style.display='block';
 document.querySelectorAll('.admin')
   .forEach(e=>e.style.display=role==='admin'?'block':'none');
 openSec('sale');
 renderProducts();
 updateDaily();
}
function logout(){location.reload();}
function openSec(id){
 document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
}

/* STOK */
function addProduct(){
 if(!pn.value||!pb.value||!pp.value||!ps.value)
   return alert('Plot√´so t√´ gjitha');
 products.push({
   n:pn.value,
   b:pb.value,
   p:+pp.value,
   s:+ps.value
 });
 save();
 pn.value=pb.value=pp.value=ps.value='';
}
function renderProducts(){
 prodTable.innerHTML=
 '<tr><th>Em√´r</th><th>Barkod</th><th>√ámim</th><th>Stok</th><th>‚ùå</th></tr>';
 products.forEach((p,i)=>{
  prodTable.innerHTML+=`
  <tr>
   <td><input value="${p.n}" onchange="products[${i}].n=this.value;save()"></td>
   <td><input value="${p.b}" onchange="products[${i}].b=this.value;save()"></td>
   <td><input type="number" value="${p.p}" onchange="products[${i}].p=+this.value;save()"></td>
   <td><input type="number" value="${p.s}" onchange="products[${i}].s=+this.value;save()"></td>
   <td><button onclick="products.splice(${i},1);save()">üóëÔ∏è</button></td>
  </tr>`;
 });
}

/* SHITJE */
function addToSale(p){
 if(p.s<1)return alert('Stok = 0');
 let s=sales.find(x=>x.b===p.b);
 if(s){ if(s.q+1>p.s)return; s.q++; }
 else sales.push({b:p.b,n:p.n,p:p.p,q:1});
 drawSale();
}
function manualAdd(code){
 let v=(code||saleScan.value).toLowerCase();
 let p=products.find(x=>x.b===v||x.n.toLowerCase().includes(v));
 if(!p)return alert('Nuk u gjet');
 addToSale(p); saleScan.value='';
}
saleScan.onkeydown=e=>e.key==='Enter'&&manualAdd();

/* SHITJE UI */
function drawSale(){
 saleTable.innerHTML=
 '<tr><th>Produkt</th><th>Sasi</th><th>Total</th><th></th></tr>';
 sales.forEach((x,i)=>{
  saleTable.innerHTML+=`
  <tr>
   <td>${x.n}</td>
   <td>${x.q}</td>
   <td>${x.q*x.p}</td>
   <td><button onclick="sales.splice(${i},1);drawSale()">üóëÔ∏è</button></td>
  </tr>`;
 });
 recalc();
}
function recalc(){
 let total=0; sales.forEach(x=>total+=x.q*x.p);
 tot.textContent=total;
 let d=(+paid.value||0)-total;
 change.textContent=d<0?`Mungojn√´ ${-d} ALL`:`Kusur ${d} ALL`;
}
paid.oninput=recalc;

/* PAGESA */
function pay(){
 let total=+tot.textContent;
 if(+paid.value<total)return alert('Shum√´ e pamjaftueshme');
 sales.forEach(x=>{
  let p=products.find(p=>p.b===x.b);
  p.s-=x.q;
 });
 daily+=total;
 localStorage.setItem('daily',daily);
 save(); cancel(); updateDaily();
}
function cancel(){
 sales=[]; saleTable.innerHTML='';
 tot.textContent=0; paid.value=''; change.textContent='';
}

/* BILANC */
function updateDaily(){dailyEl.textContent=daily;}
cashReal.oninput=()=>{
 let d=(+cashReal.value||0)-daily;
 diff.textContent=d+' ALL';
 diff.style.color=d<0?'red':'green';
};
function closeDay(){
 alert(`Sistemi: ${daily} ALL`);
 daily=0; localStorage.setItem('daily',0);
 cashReal.value=''; diff.textContent='0';
 updateDaily();
}

/* CAMERA */
function openCam(target,mode){
 scanTarget=target;
 scanLock=false;
 cam.style.display='block';

 Quagga.init({
  inputStream:{
   type:"LiveStream",
   target:scanner,
   constraints:{facingMode:{ideal:mode}}
  },
  decoder:{readers:["ean_reader","ean_8_reader","code_128_reader","upc_reader"]},
  locate:true
 },err=>{
  if(err){alert("Kamera nuk u hap");return;}
  Quagga.start();
 });

 Quagga.onDetected(d=>{
  if(scanLock)return;
  scanLock=true;
  let code=d.codeResult.code;
  if(scanTarget==='stock')pb.value=code;
  if(scanTarget==='sale')manualAdd(code);
  setTimeout(stopCam,400);
 });
}
function stopCam(){Quagga.stop();cam.style.display='none';}

/* STORAGE */
function save(){
 localStorage.setItem('products',JSON.stringify(products));
 renderProducts();
}
const dailyEl=document.getElementById('daily');
</script>

</body>
</html>
